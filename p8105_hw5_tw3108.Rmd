---
title: "p8105_hw5_tw3108"
author: "Tao Wu"
date: "2025-11-14"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r,message=FALSE,warning=FALSE}
library(tidyverse)
set.seed(123)
birthdaycheck = function(n) {
  birthdays = sample(1:365, size = n, replace = TRUE)
  any(duplicated(birthdays))
}
sim_data = function(n, time = 10000) {
   result = logical(time)
  for (i in 1:time) {
    result[i] = birthdaycheck(n)
  }
  tibble(
    groupsize = n,
    prob = mean(result)
  )
}
final = tibble()
for (n in 2:50) {
  sim = sim_data(n)
  final = bind_rows(final, sim)
}
final
final %>% 
  ggplot(aes(x = groupsize, y = prob)) +geom_point() + geom_line() +
  labs(
    x = "Group size",
    y = "Probability of shared birthday",
  ) + theme_minimal()
```

Problem 1
I think the result and plot are very reasonable, as the number of people in a group increases, the probability of shared birthday rises. It reaches 0.5 at sample size 23, which is consist with the actual theory. 

```{r,message=FALSE,warning=FALSE}
library(tidyverse)
library(broom)  
set.seed(123)
n = 30
sigma = 5
time = 5000
mu = 0:6 
sim_t = function(mu, n = 30, sigma = 5) {
  x = rnorm(n, mean = mu, sd = sigma)
  t = t.test(x, mu = 0)
  tidy(t) |> 
    select(estimate, p.value)
}
sim_t(mu = 0)
sim_results_df =
  expand_grid(
    truemu = mu,
    iter = 1:time
  ) |>
  mutate(
    estimate_df = map(truemu, sim_t)
  ) |>
  unnest(estimate_df)
power =
  sim_results_df |>
  group_by(truemu) |>
  summarize(power = mean(p.value < 0.05))
power
power |>
  ggplot(aes(x = truemu, y = power)) + geom_point() + geom_line() +
  labs(
    x = "True mean ",
    y = "Power",
  ) + theme_minimal()
est =
  sim_results_df |>
  group_by(truemu) |>
  summarize(
    mean = mean(estimate),                  
    meanreject = mean(estimate[p.value < 0.05]) 
  )
est
est |>
  ggplot(aes(x = truemu)) +
  geom_line(aes(y = mean), color = "red") +
  geom_point(aes(y = mean), color = "red") +
  geom_line(aes(y = meanreject),color = "blue") +
  geom_point(aes(y = meanreject), color = "blue") +
  labs(
    x = "True mean",
    y = "Average estimate ",
  ) + theme_minimal()
```
2 Our results show that when mu equals 0-3, the average rejection rate for h0 is greater than the actual average mu. This is definitely different because when mu is very small, the difficulty of rejection is higher because the fluctuation is not very obvious, so it will definitely be different from real mu. However, as mu increases, we should expect them to be equal since almost all the samples will be significant.
